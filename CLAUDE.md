# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

### Frontend (React + Vite)
- **Start development server**: `npm run dev`
- **Build for production**: `npm run build`
- **Preview production build**: `npm run preview`
- **Lint code**: `npm run lint`
- **Deduplicate CSV data**: `npm run dedupe`

### Backend (Express.js)
- **Start backend server**: `cd server && npm start`
- **Start backend in dev mode**: `cd server && npm run dev`
- **Install backend dependencies**: `cd server && npm install`

## Architecture Overview

This is a React + Vite Korean language study application with the following key characteristics:

### Core Application Structure
- **Frontend**: React 19 SPA built with Vite for development and building
- **Backend**: Optional Express.js API server for data persistence (fallback to localStorage)
- **Audio Files**: Served from `public/media/` directory (backend) or static files (frontend-only)

### Data Management
- **CSV-based**: Primary data format is CSV with columns: korean, english, audio
- **Dual Storage**: Backend API (server/data/) or localStorage fallback (frontend-only mode)
- **Stable Row IDs**: Each row gets a hash ID based on normalized korean+english text to maintain identity across imports/edits
- **Study Progress**: Tracked per-row via API or localStorage (`studiedRows` key)

### Key Features
- **Multiple Views**: Table view, single-item view, and random study mode
- **Audio Integration**: Supports audio playback with repeat functionality
- **AI Integration**: OpenAI API integration for translations and explanations
- **Search/Filter**: Real-time search with studied item filtering
- **Import/Export**: CSV import with automatic deduplication

### File Structure
- `src/App.jsx`: Main application component containing all logic
- `src/api.js`: Backend API client with localStorage fallback
- `src/main.jsx`: React root rendering
- `server/`: Express.js backend API server
- `server/server.js`: Main server file with API endpoints
- `server/data/`: Backend data storage (phrases.csv, studied.json)
- `scripts/dedupe-data.mjs`: Utility script for deduplicating CSV data
- `public/media/`: Directory for audio files referenced in CSV

### Data Flow
1. CSV data imported via file input or manually added
2. Sent to backend API or stored in localStorage (fallback)
3. Rendered with stable IDs for consistent study tracking
4. Study state and preferences persisted via API or localStorage

### Backend API Endpoints
- `GET /api/phrases` - Get all phrases
- `POST /api/phrases` - Add new phrase
- `PUT /api/phrases/:index` - Update phrase
- `DELETE /api/phrases/:index` - Delete phrase
- `POST /api/import` - Import CSV file
- `GET/PUT /api/studied` - Manage study progress
- `GET /media/*` - Serve audio files

### ID Generation Strategy
Row IDs are generated by hashing normalized korean+english content:
- Unicode normalization (NFKC)
- Lowercase conversion
- Punctuation/symbol removal
- Whitespace collapse

This ensures stable identification across minor formatting changes while supporting automatic migration from older ID schemes.